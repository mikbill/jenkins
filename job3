node { 
    stage('when1') {
        CLONECONTAINER = 'newJboss'
        def exists = fileExists '/var/lib/lxc/newJboss/config'

        if (exists) {
            sh "sudo lxc-destroy -n $CLONECONTAINER -f"
        }
    }

    stage('Deploy Application') { 
        sh 'sudo cp /tmp/devops-test.war $lxc_path/$container_name/rootfs/usr/local/share/jboss/standalone/deployments'
        sh "sudo lxc-copy -n $container_name -N $CLONECONTAINER -e"
        sh "sudo lxc-attach -n $CLONECONTAINER -- /opt/sleep.sh &"
        sh "sudo chmod 771 /var/lib/lxc/$CLONECONTAINER"
        sh "sudo chmod 775 /var/lib/lxc/$CLONECONTAINER/config"
    }
}

